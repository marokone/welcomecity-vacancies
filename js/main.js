class VacancyListApp{constructor(){this.config={supabaseUrl:"https://vhbiezamhpyejdqvvwuj.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZoYmllemFtaHB5ZWpkcXZ2d3VqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2Njc0MDgsImV4cCI6MjA3NzI0MzQwOH0.13h_XJ7kQFtuCjavkOXN9TzXNF2X4jX5-rcNCFiFqO0",cacheKeys:{data:"wc-vacancies-data",timestamp:"wc-vacancies-timestamp"},cacheTTL:3e5},this.state={allVacancies:[],currentProject:[],currentDepartment:[],currentQuery:"",placeholderInterval:null,supabase:null,projectCounts:{},deptCounts:{}},this.init()}async init(){console.log("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π..."),this.setupEventListeners(),this.initializeSupabase(),await this.loadVacanciesData(),console.log("‚úÖ –°–ø–∏—Å–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–π –≥–æ—Ç–æ–≤")}setupEventListeners(){const t=document.getElementById("vacancy-search");t&&t.addEventListener("input",t=>{this.state.currentQuery=t.target.value.toLowerCase(),this.renderResults()});const e=document.getElementById("reset-all-filters");e&&e.addEventListener("click",()=>{this.state.currentProject=[],this.state.currentDepartment=[],this.state.currentQuery="",t&&(t.value=""),this.renderFilters(),this.renderResults()}),this.setupFilterHandlers(),this.setupMobileFilters()}setupFilterHandlers(){["project-filter","department-filter"].forEach(t=>{const e=document.getElementById(t);if(!e)return;const s=e.querySelector(".select-header"),n=e.querySelector(".select-dropdown"),a=e.querySelector(".clear-btn");s&&s.addEventListener("click",t=>{t.stopPropagation();const s=e.classList.contains("active");document.querySelectorAll(".custom-select").forEach(t=>{if(t!==e){t.classList.remove("active");const e=t.querySelector(".select-dropdown");e&&(e.style.display="none")}}),e.classList.toggle("active"),n&&(n.style.display=s?"none":"block")}),a&&a.addEventListener("click",s=>{s.stopPropagation(),"project-filter"===t?(this.state.currentProject=[],e.classList.remove("has-selection")):(this.state.currentDepartment=[],e.classList.remove("has-selection")),this.renderFilters(),this.renderResults(),this.updateClearButtonVisibility()}),n&&n.addEventListener("change",s=>{if("checkbox"===s.target.type){const n=s.target.value,a=s.target.checked;"project-filter"===t?(a?this.state.currentProject.includes(n)||this.state.currentProject.push(n):this.state.currentProject=this.state.currentProject.filter(t=>t!==n),this.state.currentProject.length>0?e.classList.add("has-selection"):e.classList.remove("has-selection")):(a?this.state.currentDepartment.includes(n)||this.state.currentDepartment.push(n):this.state.currentDepartment=this.state.currentDepartment.filter(t=>t!==n),this.state.currentDepartment.length>0?e.classList.add("has-selection"):e.classList.remove("has-selection")),this.renderFilters(),this.renderResults(),this.updateClearButtonVisibility()}})}),document.addEventListener("click",t=>{t.target.closest(".custom-select")||document.querySelectorAll(".custom-select").forEach(t=>{t.classList.remove("active");const e=t.querySelector(".select-dropdown");e&&(e.style.display="none")})})}setupMobileFilters(){const t=document.getElementById("mobile-filters-modal"),e=document.getElementById("mobile-filters-btn");e&&t&&e.addEventListener("click",()=>{this.renderMobileFilters(),this.updateMobileApplyButton(),t.style.display="block",setTimeout(()=>{t.classList.add("active")},10)}),document.addEventListener("click",e=>{t&&"block"===t.style.display&&e.target===t&&this.closeMobileFilters()});const s=document.getElementById("clear-mobile-filters");s&&s.addEventListener("click",()=>{this.state.currentProject=[],this.state.currentDepartment=[];const t=document.getElementById("project-filter"),e=document.getElementById("department-filter");t&&t.classList.remove("has-selection"),e&&e.classList.remove("has-selection"),this.renderFilters(),this.renderResults(),this.updateMobileApplyButton(),this.updateClearButtonVisibility()});const n=document.getElementById("apply-mobile-filters");n&&n.addEventListener("click",()=>{(this.state.currentProject.length>0||this.state.currentDepartment.length>0)&&(this.renderFilters(),this.renderResults()),this.closeMobileFilters()}),document.addEventListener("change",t=>{if("checkbox"===t.target.type&&(t.target.closest("#mobile-project-options")||t.target.closest("#mobile-dept-options"))){const e=t.target.value;t.target.closest("#mobile-project-options")?t.target.checked?this.state.currentProject.includes(e)||this.state.currentProject.push(e):this.state.currentProject=this.state.currentProject.filter(t=>t!==e):t.target.checked?this.state.currentDepartment.includes(e)||this.state.currentDepartment.push(e):this.state.currentDepartment=this.state.currentDepartment.filter(t=>t!==e),this.renderMobileFilters(),this.updateMobileApplyButton(),this.updateClearButtonVisibility()}})}initializeSupabase(){return window.supabase?(this.state.supabase=window.supabase,console.log("‚úÖ Supabase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"),!0):(console.error("‚ùå Supabase JS –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω"),!1)}getCachedData(){try{const t=localStorage.getItem(this.config.cacheKeys.data),e=localStorage.getItem(this.config.cacheKeys.timestamp);if(!t||!e)return null;const s=Date.now();if(s-parseInt(e)>this.config.cacheTTL)return console.log("‚ÑπÔ∏è –ö—ç—à —É—Å—Ç–∞—Ä–µ–ª, —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"),null;const n=JSON.parse(t);return console.log("‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –∫—ç—à–∞:",n.vacancies?.length,"–≤–∞–∫–∞–Ω—Å–∏–π"),n.vacancies||[]}catch(t){return console.error("‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∫—ç—à–∞:",t),null}}saveToCache(t){try{const e={vacancies:t,timestamp:Date.now()};localStorage.setItem(this.config.cacheKeys.data,JSON.stringify(e)),localStorage.setItem(this.config.cacheKeys.timestamp,Date.now().toString()),console.log("üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –∫—ç—à:",t.length,"–≤–∞–∫–∞–Ω—Å–∏–π")}catch(t){console.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –∫—ç—à:",t)}}formatVacancyData(t){return{id:t.id,title:t.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",project_name:t.project_name||"–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞",project:t.project||t.project_name||"–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞",department:t.department||"–ë–µ–∑ –æ—Ç–¥–µ–ª–∞",description:t.description||"",requirements:t.requirements||"",responsibilities:t.responsibilities||"",conditions:t.conditions||"",format:t.format||"–ù–µ —É–∫–∞–∑–∞–Ω",status:t.status,created_at:t.created_at,seo_title:t.seo_title||t.title,seo_description:t.seo_description||t.description?.substring(0,160)}}async loadFromSupabase(){if(!this.state.supabase&&!this.initializeSupabase())throw new Error("Supabase –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω");console.log("üì° –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Supabase...");const{data:t,error:e}=await this.state.supabase.from("vacancies").select("*").eq("status","active").order("created_at",{ascending:!1});if(e)throw console.error("‚ùå –û—à–∏–±–∫–∞ Supabase:",e),e;if(t&&t.length>0){const e=t.map(t=>this.formatVacancyData(t));this.state.allVacancies=e,this.saveToCache(this.state.allVacancies),this.calculateCounts(),console.log("‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ Supabase:",this.state.allVacancies.length,"–≤–∞–∫–∞–Ω—Å–∏–π")}else console.log("‚ÑπÔ∏è –í Supabase –Ω–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π"),this.state.allVacancies=[],this.saveToCache([])}calculateCounts(){this.state.projectCounts={},this.state.allVacancies.forEach(t=>{const e=t.project||"–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞";this.state.projectCounts[e]=(this.state.projectCounts[e]||0)+1}),this.state.deptCounts={},this.state.allVacancies.forEach(t=>{const e=t.department||"–ë–µ–∑ –æ—Ç–¥–µ–ª–∞";this.state.deptCounts[e]=(this.state.deptCounts[e]||0)+1})}async loadVacanciesData(){try{const t=this.getCachedData();t&&t.length>0&&(this.state.allVacancies=t,this.calculateCounts(),this.updateInterface()),await this.loadFromSupabase(),this.updateInterface()}catch(t){if(console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:",t),0===this.state.allVacancies.length){const t=this.getCachedData();t&&t.length>0?(this.state.allVacancies=t,this.calculateCounts(),this.updateInterface(),this.showNotification("–ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ","info")):this.showError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏–∏")}}}updateInterface(){if(0===this.state.allVacancies.length)return void this.showEmptyState();const t=document.getElementById("vacancy-search");if(t&&this.state.allVacancies.length>0){const e=this.state.allVacancies.map(t=>t.title).filter(t=>t&&t.trim());if(e.length>0){let s=0;const n=()=>{t.placeholder=e[s]||"–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏",s=(s+1)%e.length};n(),this.state.placeholderInterval&&clearInterval(this.state.placeholderInterval),this.state.placeholderInterval=setInterval(n,1e3)}}this.renderFilters(),this.renderResults()}showEmptyState(){const t=document.getElementById("vacancy-results");t&&(t.innerHTML='\n                <div style="text-align:center; padding: 60px 20px; color: #666;">\n                    <div style="font-size: 48px; margin-bottom: 16px;">üòî</div>\n                    <h3 style="margin: 0 0 8px 0; color: #333;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π</h3>\n                    <p style="margin: 0; opacity: 0.7;">–°–≤—è–∂–∏—Ç–µ—Å—å —Å HR-–æ—Ç–¥–µ–ª–æ–º –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è</p>\n                </div>\n            ')}showError(t){const e=document.getElementById("vacancy-results");e&&(e.innerHTML=`\n                <div style="text-align:center; padding: 40px 20px; color: #666;">\n                    <div style="font-size: 48px; margin-bottom: 16px;">‚ö†Ô∏è</div>\n                    <h3 style="margin: 0 0 8px 0; color: #333;">${t}</h3>\n                    <button onclick="location.reload()" style="\n                        margin-top: 20px;\n                        padding: 12px 24px;\n                        background: #048868;\n                        color: white;\n                        border: none;\n                        border-radius: 6px;\n                        cursor: pointer;\n                    ">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>\n                </div>\n            `)}showNotification(t,e="info"){const s=document.createElement("div");s.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 12px 20px;\n            border-radius: 8px;\n            color: white;\n            z-index: 10000;\n            font-family: 'ALSHaussNext', sans-serif;\n            font-size: 14px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n            transition: all 0.3s ease;\n            max-width: 300px;\n        ";const n={success:"#27ae60",error:"#e74c3c",info:"#3498db",warning:"#f39c12"};s.style.background=n[e]||n.info,s.textContent=t,document.body.appendChild(s),setTimeout(()=>{s.style.opacity="0",s.style.transform="translateX(100px)",setTimeout(()=>s.remove(),300)},3e3)}getAvailableProjects(){const t={};return this.state.allVacancies.forEach(e=>{const s=e.project||"–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞";t[s]=(t[s]||0)+1}),t}getAvailableDepartments(){const t={};return this.state.allVacancies.forEach(e=>{const s=e.department;t[s]=(t[s]||0)+1}),t}renderFilters(){const t=this.getAvailableProjects(),e=this.getAvailableDepartments(),s=document.getElementById("project-filter"),n=document.getElementById("department-filter");if(s){const e=s.querySelector(".select-dropdown"),n=s.querySelector(".selected-values");e&&(e.innerHTML=Object.entries(t).sort(([t],[e])=>t.localeCompare(e)).map(([t,e])=>{const s=this.state.currentProject.includes(t)?"checked":"",n=`proj-${t.replace(/\s+/g,"-")}`;return`\n                            <div class="select-option">\n                                <input type="checkbox" value="${t}" ${s} id="${n}">\n                                <label for="${n}">\n                                    ${t} <span class="option-count">(${e})</span>\n                                </label>\n                            </div>\n                        `}).join("")),n&&(n.textContent=this.state.currentProject.length>0?this.state.currentProject.join(", "):"–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã",s.classList.toggle("has-selection",this.state.currentProject.length>0))}if(n){const t=n.querySelector(".select-dropdown"),s=n.querySelector(".selected-values");t&&(t.innerHTML=Object.entries(e).sort(([t],[e])=>t.localeCompare(e)).map(([t,e])=>{const s=this.state.currentDepartment.includes(t)?"checked":"",n=`dept-${t.replace(/\s+/g,"-")}`;return`\n                            <div class="select-option">\n                                <input type="checkbox" value="${t}" ${s} id="${n}">\n                                <label for="${n}">\n                                    ${t} <span class="option-count">(${e})</span>\n                                </label>\n                            </div>\n                        `}).join("")),s&&(s.textContent=this.state.currentDepartment.length>0?this.state.currentDepartment.join(", "):"–í—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è",n.classList.toggle("has-selection",this.state.currentDepartment.length>0))}this.renderMobileFilters(),this.updateResetButtonVisibility(),this.updateMobileApplyButton(),this.updateClearButtonVisibility()}renderMobileFilters(){const t=this.getAvailableProjects(),e=this.getAvailableDepartments(),s=document.getElementById("mobile-project-options");s&&(s.innerHTML=Object.entries(t).sort(([t],[e])=>t.localeCompare(e)).map(([t,e])=>{const s=this.state.currentProject.includes(t)?"checked":"",n=`mob-proj-${t.replace(/\s+/g,"-")}`;return`\n                        <label class="mobile-filter-option">\n                            <input type="checkbox" value="${t}" ${s} id="${n}">\n                            <span>\n                                ${t} <span class="option-count">(${e})</span>\n                            </span>\n                        </label>\n                    `}).join(""));const n=document.getElementById("mobile-dept-options");n&&(n.innerHTML=Object.entries(e).sort(([t],[e])=>t.localeCompare(e)).map(([t,e])=>{const s=this.state.currentDepartment.includes(t)?"checked":"",n=`mob-dept-${t.replace(/\s+/g,"-")}`;return`\n                        <label class="mobile-filter-option">\n                            <input type="checkbox" value="${t}" ${s} id="${n}">\n                            <span>\n                                ${t} <span class="option-count">(${e})</span>\n                            </span>\n                        </label>\n                    `}).join(""));const a=document.querySelector('.filter-item[data-type="projects"] .filter-value'),r=document.querySelector('.filter-item[data-type="departments"] .filter-value');a&&(a.textContent=this.state.currentProject.length?this.state.currentProject.join(", "):"–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã"),r&&(r.textContent=this.state.currentDepartment.length?this.state.currentDepartment.join(", "):"–í—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è")}renderResults(){const t=document.getElementById("vacancy-results");if(!t)return;const e=this.state.allVacancies.filter(t=>{const e=0===this.state.currentProject.length||this.state.currentProject.includes(t.project||"–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞"),s=0===this.state.currentDepartment.length||this.state.currentDepartment.includes(t.department),n=""===this.state.currentQuery||t.title&&t.title.toLowerCase().includes(this.state.currentQuery)||t.description&&t.description.toLowerCase().includes(this.state.currentQuery);return e&&s&&n});if(0===e.length)return void(t.innerHTML='\n                <div style="text-align:center;color:#999;padding:40px 0;">\n                    <p>–í–∞–∫–∞–Ω—Å–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>\n                    <p style="font-size:14px;margin-top:8px;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>\n                </div>\n            ');const s={};e.forEach(t=>{const e=t.department||"–ë–µ–∑ –æ—Ç–¥–µ–ª–∞";s[e]||(s[e]=[]),s[e].push(t)});const n=Object.keys(s).sort().map(t=>{const e=s[t],n=e.length;return`\n                    <h2 class="department-header">${t.charAt(0).toUpperCase()+t.slice(1)} <span class="dept-count">${n}</span></h2>\n                    ${e.map(t=>{const e=t.project||"–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞";return`\n                            <div class="vacancy-card-wrapper">\n                                <a href="${`/vacancy?id=${t.id}`}" class="vacancy-card">\n                                    <div class="vacancy-content">\n                                        <h3>${t.title}</h3>\n                                        <p class="vacancy-meta">${e} ‚Äî ${t.department}</p>\n                                    </div>\n                                    <span class="arrow-icon">‚Üí</span>\n                                </a>\n                            </div>\n                        `}).join("")}\n                `}).join("");t.innerHTML=n}updateResetButtonVisibility(){const t=this.state.currentProject.length>0||this.state.currentDepartment.length>0||this.state.currentQuery.trim(),e=document.getElementById("reset-all-filters");e&&(e.style.display=t?"block":"none")}updateMobileApplyButton(){const t=document.getElementById("apply-mobile-filters");if(!t)return;this.state.currentProject.length>0||this.state.currentDepartment.length>0?(t.textContent="–ü–æ–∫–∞–∑–∞—Ç—å",t.style.background="#048868"):(t.textContent="–û—Ç–º–µ–Ω–∏—Ç—å",t.style.background="#666")}updateClearButtonVisibility(){const t=document.querySelector(".filter-clear-btn");if(t){const e=this.state.currentProject.length>0||this.state.currentDepartment.length>0;t.classList.toggle("visible",e)}}closeMobileFilters(){const t=document.getElementById("mobile-filters-modal");t&&(t.classList.remove("active"),setTimeout(()=>{t.style.display="none"},300))}}window.location.pathname.includes("search-vacancy")&&(window.vacancyListApp=new VacancyListApp);