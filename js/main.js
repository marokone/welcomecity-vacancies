const SUPABASE_URL="https://vhbiezamhpyejdqvvwuj.supabase.co",SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5...",supabase=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);let allVacancies=[],currentFilters={projects:[],departments:[]},currentQuery="";const inputSearch=document.getElementById("vacancy-search"),resultsContainer=document.getElementById("vacancy-results"),projectFilterEl=document.getElementById("project-filter"),deptFilterEl=document.getElementById("department-filter"),resetAllBtn=document.getElementById("reset-all-filters");async function loadVacancies(){try{const{data:e,error:t}=await supabase.from("vacancies").select("*").eq("status","active").order("created_at",{ascending:!1});if(t)return console.error("Ошибка Supabase:",t),void(resultsContainer.innerHTML="<p>Не удалось загрузить вакансии</p>");allVacancies=e,renderFilters(),renderResults()}catch(e){console.error("Ошибка загрузки:",e),resultsContainer.innerHTML="<p>Ошибка при загрузке вакансий</p>"}}function getAvailableProjects(){const e={};return allVacancies.forEach(t=>{const r=t.project||"Без проекта";e[r]||(e[r]=0),e[r]++}),e}function getAvailableDepartments(){const e={};return allVacancies.forEach(t=>{const r=t.department||"Без отдела";e[r]||(e[r]=0),e[r]++}),e}function renderFilters(){if(projectFilterEl){const e=getAvailableProjects();projectFilterEl.querySelector(".select-dropdown").innerHTML=Object.entries(e).map(([e,t])=>`<label><input type="checkbox" value="${e}"> ${e} (${t})</label>`).join("")}if(deptFilterEl){const e=getAvailableDepartments();deptFilterEl.querySelector(".select-dropdown").innerHTML=Object.entries(e).map(([e,t])=>`<label><input type="checkbox" value="${e}"> ${e} (${t})</label>`).join("")}}function renderResults(){const e=currentQuery.toLowerCase(),t=allVacancies.filter(t=>{const r=!e||t.title&&t.title.toLowerCase().includes(e)||t.description&&t.description.toLowerCase().includes(e),n=!currentFilters.projects.length||currentFilters.projects.includes(t.project||"Без проекта"),c=!currentFilters.departments.length||currentFilters.departments.includes(t.department||"Без отдела");return r&&n&&c});0!==t.length?resultsContainer.innerHTML=t.map(e=>{const t=e.title||"Без названия",r=e.project||"Без проекта",n=e.department||"Без отдела";return`\n      <div class="vacancy-card">\n        <a href="/vacancy?vacancy_id=${e.id}" class="vacancy-card-link">\n          <div class="vacancy-title">${t}</div>\n          <div class="vacancy-meta">\n            ${r} — ${n}\n          </div>\n        </a>\n      </div>\n    `}).join(""):resultsContainer.innerHTML="<p>Вакансий не найдено</p>"}inputSearch&&inputSearch.addEventListener("input",e=>{currentQuery=e.target.value,renderResults()}),projectFilterEl&&projectFilterEl.addEventListener("change",e=>{const t=e.target.value;e.target.checked?currentFilters.projects.push(t):currentFilters.projects=currentFilters.projects.filter(e=>e!==t),renderResults()}),deptFilterEl&&deptFilterEl.addEventListener("change",e=>{const t=e.target.value;e.target.checked?currentFilters.departments.push(t):currentFilters.departments=currentFilters.departments.filter(e=>e!==t),renderResults()}),resetAllBtn&&resetAllBtn.addEventListener("click",()=>{currentFilters.projects=[],currentFilters.departments=[],currentQuery="",inputSearch&&(inputSearch.value=""),renderFilters(),renderResults()}),document.addEventListener("DOMContentLoaded",()=>{loadVacancies()});